{% extends 'base/base.html' %}

{% block title %}
Product Details
{% endblock %}

{% block content %}

<!-- ===== CUSTOM STYLE FOR CAROUSEL BUTTONS ===== -->
<style>
    .carousel-btn {
        position: absolute;
        top: 10px;
        padding: 5px 14px;
        font-size: 14px;
        font-weight: 600;
        border-radius: 6px;
        background: rgba(0, 0, 0, 0.6);
        color: white;
        backdrop-filter: blur(5px);
        z-index: 10;
    }


    .btn-edit-carousel {
        left: 10px;
    }

    .btn-delete-carousel {
        right: 10px;
    }
</style>

<section class="luxury-wrapperr my-5">
    <div class="container luxury-container">

        <div class="row align-items-start">

            <!-- ================= LEFT: CAROUSEL ================= -->
            <div class="col-md-6 mb-4">
                <div class="luxury-image-box">

                    <!-- ==== ACTUAL CAROUSEL ==== -->
                    <div id="productCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000">
                        <div class="carousel-inner">

                            {% if product.images.all %}
                            {% for image in product.images.all %}
                            <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                <img src="{{ image.img.url }}" class="d-block w-100 h-100 rounded shadow"
                                    style="max-height:420px; object-fit:cover;">

                                <!-- ==== EDIT BUTTON ==== -->
                                <a href="{% url 'edit_prod_image' image.pk %}" class="carousel-btn btn-edit-carousel">
                                    <i class="bi bi-pencil-square"></i>
                                </a>

                                <!-- ==== DELETE BUTTON ==== -->
                                <a href="{% url 'del_prod_image' image.pk %}" class="carousel-btn btn-delete-carousel">
                                    <i class="bi bi-trash3"></i>
                                </a>

                            </div>

                            {% endfor %}
                            {% else %}
                            <!--===== FALLBACK IMAGE / MESSAGE ===== -->
                            <div class="carousel-item active">
                                <div class="d-flex justify-content-center align-items-center bg-light rounded"
                                    style="height:420px; border:2px dashed #ccc;">
                                    <p class="text-muted fw-semibold">No images uploaded yet</p>
                                </div>
                            </div>
                            {% endif %}

                        </div>


                        <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel"
                            data-bs-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                        </button>

                        <button class="carousel-control-next" type="button" data-bs-target="#productCarousel"
                            data-bs-slide="next">
                            <span class="carousel-control-next-icon"></span>
                        </button>
                    </div>

                </div>
            </div>

            <!-- ================= RIGHT: PRODUCT INFO ================= -->
            <div class="col-md-6">
                <div class="luxury-info">


                    <img src="{{ product.thumbnail.url }}" class="img-fluid mb-3"
                        style="height:120px; width:auto; border-radius:10px;">

                    <h2 class="luxury-title">{{ product.title }}</h2>

                    <p class="luxury-desc">{{ product.desc|truncatechars:92 }}</p>

                    <h4 class="luxury-price">₹ {{ product.price }}</h4>
                    <!-- SIMPLE DELIVERY INFO (Minimal & Clean) -->
                    <ul class="list-unstyled luxury-features mt-3 text-light d-flex ">
                        <li class="mb-1 me-2">
                            <i class="bi bi-truck text-primary "></i>
                            Fast Delivery (2–4 Days)
                        </li>
                        <li class="mb-1 me-2">
                            <i class="bi bi-shield-check text-success"></i>
                            Safe & Secure Packaging
                        </li>
                        <li class="mb-1 me-2">
                            <i class="bi bi-arrow-repeat text-warning"></i>
                            Easy Return Available
                        </li>
                    </ul>




                    <div id="products-container" data-add-url="{% url 'add_to_cart' %}">
                        <div class="product-card-section" data-product-id="{{ product.pk }}">
                            {% if not user.is_staff %}
                            {% if product.stock > 0 %}
                            <!-- IN STOCK -->
                            <button class="btn btn-dark w-100 add-to-cart">
                                Add to Cart
                            </button>
                            {% else %}
                            <!-- OUT OF STOCK -->
                            <button class="btn btn-warning w-100" disabled>
                                Out of Stock
                            </button>

                            <button class="btn btn-secondary w-100 mt-2 notify-btn" data-product="{{ product.id }}">
                                Notify Me
                            </button>
                            {% endif %}

                            {%endif%}

                            {% if user.is_staff %}
                            <a href="{% url 'edit_product' product.pk %}" class="btn-luxury-gold me-2 text-decoration-none">Edit</a>
                            <a href="{% url 'delete_product' product.pk %}" class="btn-luxury-red me-2 text-decoration-none">Delete</a>
                            <a href="{% url 'add_image' product.pk %}" class="btn-luxury-gold text-decoration-none">
                                <i class="bi bi-upload"></i> upload
                            </a>
                            {% endif %}
                        </div>


                    </div>
                </div>


            </div>
        </div>


</section>


{% endblock %}