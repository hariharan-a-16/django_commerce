<style>
    .product-unavailable {
        position: relative;
        overflow: hidden;
    }

    .card-body {
        box-shadow: rgba(50, 50, 93, 0.25) 0px 50px 100px -20px, rgba(0, 0, 0, 0.3) 0px 30px 60px -30px, rgba(10, 37, 64, 0.35) 0px -2px 6px 0px inset;
    }

    .product-unavailable img {
        filter: blur(4px) grayscale(60%);
        opacity: 0.3;
        transition: 0.3s ease;
    }

    .product-unavailable:hover img {
        filter: blur(2px) grayscale(30%);
        opacity: 0.4;
    }

    .unavailable-badge {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.75);
        padding: 10px 20px;
        color: #fff;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
</style>




<div class="card product-card h-100 shadow-sm {% if product.stock == 0 %} product-unavailable {% endif %} product-card-section"
    data-product-id="{{ product.id }}">

    <div class="position-relative">

        {% if product.thumbnail %}
        <img src="{{ product.thumbnail.url }}" class="card-img-top product-thumb" alt="{{ product.title }}">
        {% else %}
        <div class="product-thumb placeholder-img">
            No Image
        </div>
        {% endif %}

        {% if product.stock == 0 %}
        <div class="unavailable-badge">Currently Unavailable</div>
        {% endif %}

    </div>

    <div class="card-body d-flex flex-column">

        <a href="{% url 'product_details' product.pk %}" class="text-decoration-none text-dark">
            <h6 class="card-title product-title">
                {{ product.title }}
            </h6>
        </a>

        <p class="card-text product-desc">
            {{ product.desc|truncatechars:70 }}
        </p>

        <div class="mt-auto">
            <div class="product-price mb-2">
                â‚¹ {{ product.price }}
            </div>

            {% if user.is_authenticated %}

            {% if user.is_staff %}
            <!-- ADMIN VIEW -->
            {% if product.stock > 0 %}
            <span class="badge bg-success w-100 py-2">Stock: {{ product.stock }}</span>
            {% else %}
            <span class="badge bg-danger w-100 py-2">Out of Stock</span>
            {% endif %}

            {% else %}
            <!-- NORMAL USER VIEW -->
            {% if product.stock > 0 %}
            <button class="btn btn-sm btn-dark w-100 add-to-cart">
                Add to Cart
            </button>
            {% else %}
            <button class="btn btn-sm btn-warning w-100 notify-btn" data-product="{{ product.id }}">
                Notify Me
            </button>
            {% endif %}
            {% endif %}

            {% else %}
            <!-- USER NOT LOGGED IN -->
            <a href="{% url 'login' %}" class="btn btn-dark w-100">
                Login to Buy
            </a>
            {% endif %}
        </div>

    </div>
</div>